<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Minecraft Web - High-Speed Secure Login">
    <link rel="icon" href="https://kakaomames.github.io/rei/logo.png">
    <title>ãƒ­ã‚°ã‚¤ãƒ³ - Minecraft Web</title>
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .login-box { background: #333; padding: 30px; border: 2px solid #555; width: 300px; text-align: center; }
        input { width: 90%; padding: 10px; margin: 10px 0; background: #444; border: 1px solid #666; color: white; }
        .btn { width: 100%; padding: 12px; background: #4a4a4a; color: white; border: 1px solid #fff; cursor: pointer; }
        .btn:hover { background: #5a5a5a; }
        .error { color: #ff4444; font-size: 0.8rem; margin-top: 10px; display: none; }
    </style>
</head>
<body>
    <div class="login-box">
        <img src="https://kakaomames.github.io/rei/logo.png" width="60" style="margin-bottom: 10px;">
        <h2>Minecraft Web ãƒ­ã‚°ã‚¤ãƒ³</h2>
        <input type="text" id="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
        <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
        <button class="btn" id="login-execute">ãƒ­ã‚°ã‚¤ãƒ³</button>
        <div id="error-msg" class="error">ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™</div>
        <p style="font-size: 0.8rem; margin-top: 15px; cursor: pointer; text-decoration: underline;" onclick="window.location.href='signin.html'">æ–°è¦ç™»éŒ²ã¯ã“ã¡ã‚‰</p>
    </div>

    <script>
        document.getElementById('login-execute').onclick = async () => {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            const errorEl = document.getElementById('error-msg');

            try {
                // 1. manifest.json ã‹ã‚‰ UUID ã‚’å–å¾— ğŸ”
                const mRes = await fetch('https://kakaomames.github.io/userdata/manifest.json');
                const manifest = await mRes.json();
                const uuid = manifest[u];

                if (!uuid) throw new Error('User not found');

                // 2. uuid.json ã‹ã‚‰è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾— ğŸ“‚
                const uRes = await fetch(`https://kakaomames.github.io/userdata/${uuid}.json`);
                const userData = await uRes.json();

                // 3. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç…§åˆï¼ˆéšŠå“¡æŒ‡å®šã®PWãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰ ğŸ”‘
                if (userData.password === p) {
                    console.log("ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼ä¸–ç•Œã‚’èª­ã¿è¾¼ã¿ã¾ã™...");
                    sessionStorage.setItem('current_user', u);
                    sessionStorage.setItem('current_uuid', uuid);
                    window.location.href = 'menu.html';
                } else {
                    throw new Error('Invalid password');
                }
            } catch (e) {
                errorEl.style.display = 'block';
                console.error("Login Failed:", e.message);
            }
        };
    </script>
</body>
</html>
