name: Minecraft Server Engine
on:
  repository_dispatch:
    types: [start_minecraft]

jobs:
  run-server:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸš€ ã‚µãƒ¼ãƒãƒ¼èµ·å‹•æº–å‚™
        run: |
          echo "Gemini programmingéšŠã€å‡ºå‹•é–‹å§‹ï¼"
          
          # 1. ã‚µãƒ¼ãƒãƒ¼æœ¬ä½“(PaperMC 1.20.1)ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
          curl -o server.jar https://api.papermc.io/v2/projects/paper/versions/1.20.1/builds/196/downloads/paper-1.20.1-196.jar
          echo "eula=true" > eula.txt
          
          # 2. æ¥ç¶šãƒˆãƒ³ãƒãƒ«(ngrok)ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
          curl -s https://ngrok-agent.s3.amazonaws.com/ngrok.asc | sudo tee /etc/apt/trusted.gpg.d/ngrok.asc >/dev/null
          echo "deb https://ngrok-agent.s3.amazonaws.com buster main" | sudo tee /etc/apt/sources.list.d/ngrok.list
          sudo apt update && sudo apt install ngrok jq -y

          # 3. ãƒˆãƒ³ãƒãƒ«ã‚’èµ·å‹• (ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰)
          # æ³¨æ„: ngrokã¯æœ¬æ¥ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãŒå¿…è¦ã ãŒã€ãŠè©¦ã—ã§ä¸€æ™‚èµ·å‹•ã‚’è©¦ã¿ã‚‹
          ngrok tcp 25565 --log=stdout &
          
          # 4. å°‘ã—å¾…ã£ã¦ã‹ã‚‰æ¥ç¶šã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒ­ã‚°ã«è¡¨ç¤º
          sleep 10
          echo "--------------------------------------------------"
          echo "â–¼â–¼â–¼ ã‚«ã‚«ã‚ªãƒãƒ¡éšŠå“¡ã€æ¥ç¶šã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã“ã‚Œã ï¼ â–¼â–¼â–¼"
          curl -s http://localhost:4040/api/tunnels | jq -r '.tunnels[0].public_url'
          echo "â–²â–²â–² ã“ã‚Œã‚’ãƒã‚¤ã‚¯ãƒ©ã®ã‚µãƒ¼ãƒãƒ¼ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å…¥ã‚Œã¦ãã‚Œ â–²â–²â–²"
          echo "--------------------------------------------------"
          
          # 5. ãƒã‚¤ã‚¯ãƒ©ã‚µãƒ¼ãƒãƒ¼èµ·å‹• (ãƒ¡ãƒ¢ãƒª7GBè§£æ”¾ï¼)
          java -Xmx7G -Xms7G -jar server.jar nogui
