name: Minecraft Server Engine
on:
  repository_dispatch:
    types: [start_minecraft]

jobs:
  run-server:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸš€ ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼†ãƒˆãƒ³ãƒãƒ«(playit)é–‹é€š
        run: |
          echo "Gemini programmingéšŠã€playit.ggã§ä½œæˆ¦å†é–‹ï¼"
          
          # 1. ã‚µãƒ¼ãƒãƒ¼æœ¬ä½“ã®æº–å‚™
          curl -o server.jar https://api.papermc.io/v2/projects/paper/versions/1.20.1/builds/196/downloads/paper-1.20.1-196.jar
          echo "eula=true" > eula.txt
          
          # 2. playit.ggã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
          curl -SsL https://playit-cloud.github.io/ppa/key.gpg | sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/playit.gpg
          echo "deb [signed-by=/etc/apt/trusted.gpg.d/playit.gpg] https://playit-cloud.github.io/ppa/data-postgresql /" | sudo tee /etc/apt/sources.list.d/playit-cloud.list
          sudo apt update && sudo apt install playit -y

          # 3. playitã®èµ·å‹• (ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½¿ã‚ãšã€ã¾ãšã¯ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”¨URLã‚’è¡¨ç¤ºã•ã›ã‚‹)
          echo "--------------------------------------------------"
          echo "â–¼â–¼â–¼ ã‚«ã‚«ã‚ªãƒãƒ¡éšŠå“¡ã€ä»¥ä¸‹ã®URLã‚’ã‚¹ãƒãƒ›ã§é–‹ã„ã¦è¨­å®šã›ã‚ˆï¼ â–¼â–¼â–¼"
          # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èµ·å‹•ã—ã€æœ€åˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”¨ãƒ­ã‚°ãŒå‡ºã‚‹ã¾ã§å¾…ã¤
          playit setup --once || true
          echo "â–²â–²â–² ä¸Šè¨˜URLã§Agentã‚’ç™»éŒ²ã—ãŸã‚‰ã€ã‚‚ã†ä¸€åº¦å®Ÿè¡Œã ï¼ â–²â–²â–²"
          echo "--------------------------------------------------"
          
          # 4. ãƒã‚¤ã‚¯ãƒ©ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆã“ã“ã‹ã‚‰å…ˆã¯å‰ã®ã¾ã¾ã ï¼ï¼‰
          java -Xmx7G -Xms7G -jar server.jar nogui
