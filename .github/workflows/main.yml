name: Minecraft Server Engine
on:
  repository_dispatch:
    types: [start_minecraft]

jobs:
  run-server:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸš€ ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼†ãƒˆãƒ³ãƒãƒ«é–‹é€š
        run: |
          echo "Gemini programmingéšŠã€playitç›´æ¥èµ·å‹•ä½œæˆ¦é–‹å§‹ï¼"
          
          # 1. ã‚µãƒ¼ãƒãƒ¼æœ¬ä½“ã®æº–å‚™
          curl -o server.jar https://api.papermc.io/v2/projects/paper/versions/1.20.1/builds/196/downloads/paper-1.20.1-196.jar
          echo "eula=true" > eula.txt
          
          # 2. playitæœ¬ä½“ã‚’ç›´æ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œæ¨©é™ã‚’ä¸ãˆã‚‹
          curl -SsL -o playit https://github.com/playit-cloud/playit-agent/releases/latest/download/playit-linux-amd64
          chmod +x playit

          # 3. playitã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ï¼ˆ1å›ãã‚Šï¼‰
          echo "--------------------------------------------------"
          echo "â–¼â–¼â–¼ ã‚«ã‚«ã‚ªãƒãƒ¡éšŠå“¡ã€ã“ã®ä¸‹ã®URLã‚’ã‚¹ãƒãƒ›ã§é–‹ã‘ï¼ â–¼â–¼â–¼"
          # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‹•ã‹ã—ã¦ã€URLãŒå‡ºã‚‹ã¾ã§å°‘ã—å¾…ã¤
          ./playit setup --once || true
          echo "â–²â–²â–² ç™»éŒ²ãŒçµ‚ã‚ã£ãŸã‚‰ã€ã‚‚ã†ä¸€åº¦ã€Œã—ã‚…ã£ã±ã¤ã€ã ï¼ â–²â–²â–²"
          echo "--------------------------------------------------"
          
          # 4. ãƒã‚¤ã‚¯ãƒ©ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
          java -Xmx7G -Xms7G -jar server.jar nogui
